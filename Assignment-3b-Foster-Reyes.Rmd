---
title: "Introduction to Statistical Concepts, MSCA 31000, Assignment 3b"
author: "Hope Foster-Reyes"
date: "March 10, 2016"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Prepare Environment

Load libraries.

```{r libraries}
library(xlsx)
library(MKmisc)
```


Download data from online Url to subdirectory local to this RStudio project.

```{r download-data}
if (!file.exists("data")) {
  dir.create("data")
}

# !!!This version of file via automated download fails. 
# Remainder of code for assigment assumes manually imported version of .xlsx file located 
# in data subdirectory of working (.rproj) directory
am.url <- "http://onlinestatbook.com/2/case_studies/data/angry_moods.xls"
am.file <- "./data/angry_moods.xls"
if (!file.exists(am.file)) {
  download.file(am.url, destfile = am.file)
}
```

Import data.

```{r import-data}
am.df <- read.xlsx(am.file, 
                   sheetName = "angry_moods.txt", 
                   header = TRUE,
                   colClasses = rep("integer", 7))
```

## Chapter 10, Q24.

### 1. Calculate sample difference between means:

```{r q24-mean}
male.sample.size <- sum(am.df$Gender == 1)
female.sample.size <- sum(am.df$Gender == 2)

male.sample.mean <- mean(am.df$Anger.Out[am.df$Gender == 1])
female.sample.mean <- mean(am.df$Anger.Out[am.df$Gender == 2])
mf.sample.mean.diff <-  male.sample.mean - female.sample.mean
```

$\bar{x}_{AOm}$ = `r male.sample.mean`

$\bar{x}_{AOf}$ = `r female.sample.mean`

$\bar{x}_{AOm} - \bar{x}_{AOf}$ = `r mf.sample.mean.diff`

#### Visualize distributions:

```{r q24-boxplot}
list.q24 <- list(
  Male = am.df$Anger.Out[am.df$Gender == 1], 
  Female = am.df$Anger.Out[am.df$Gender == 2])

boxplot(list.q24, main = "Anger Out Scores, Type 7")
```

### 2. Estimate the standard error of the difference between means:

```{r q24-estse}
male.SS <- sum((am.df$Anger.Out[am.df$Gender == 1] - male.sample.mean)^2)
female.SS <- sum((am.df$Anger.Out[am.df$Gender == 2] - female.sample.mean)^2)
mf.SSE <- male.SS + female.SS

mf.df <- (male.sample.size - 1) + (female.sample.size - 1)
mf.MSE <- mf.SSE / mf.df
mf.hmean <- 2 / (1/male.sample.size + 1/female.sample.size)

mf.sampling.diff.estse <- sqrt(2* mf.MSE / mf.hmean)
```

$s_{\bar{x}_{AOm} - \bar{x}_{AOf}} = \sqrt{\frac{2MSE}{n_h}}$

$MSE = \frac{SSE}{df}$

$SSE = \sum_{i}^{n} (x_{Aom_{i}} - \bar{x}_{AOm})^2 + \sum_{i}^{n} (x_{AOf_i} - \bar{x}_{AOf})^2$

$SSE = \sum_{i}^{`r male.sample.size`}(x_{AOm_{i}} - `r male.sample.mean`)^2 +
  \sum_{i}^{`r female.sample.size`}(x_{AOf_i} - `r female.sample.mean`)^2$
  
$SSE = `r mf.SSE`$

$df = (n_{AOm} - 1) + (n_{AOf} - 1) = (`r male.sample.size` - 1) + (`r female.sample.size` - 1) = `r mf.df`$

$MSE = \frac{SSE}{df} = \frac{`r mf.SSE`}{`r mf.df`} = `r mf.MSE`$

$n_h = \frac{2}{(\frac{1}{n_{AOm}} + \frac{1}{n_{AOf}})} = \frac{2}{(\frac{1}{`r male.sample.size`} +
  \frac{1}{`r female.sample.size`})} = `r mf.hmean`$

$s_{\bar{x}_{AOm} - \bar{x}_{AOf}} = \sqrt{\frac{2MSE}{n_h}}$

$s_{\bar{x}_{AOm} - \bar{x}_{AOf}} = \sqrt{\frac{(2)(`r mf.MSE`)}{`r mf.hmean`}} = `r mf.sampling.diff.estse`$

### 3. Find t critical value:

```{r q24-ci}
Y.99 <- 0.99
t.99 <- qt((1 - Y.99)/2, df = mf.df, lower.tail = FALSE)

mf.LL <- male.sample.mean - female.sample.mean - (t.99 * mf.sampling.diff.estse)
mf.UL <- male.sample.mean - female.sample.mean + (t.99 * mf.sampling.diff.estse)
```

Degrees of Freedom = `r mf.df`

99% t Critical Value = `r t.99`

### 4. Calculate confidence interval:

Lower Limit = $\bar{x}_{AOm} - \bar{x}_{AOf} - (t)(s_{\bar{x}_{AOm} - \bar{x}_{AOf}})$

Lower Limit = `r male.sample.mean` - `r female.sample.mean` - (`r t.99`)(`r mf.sampling.diff.estse`)

Lower Limit = `r mf.LL`

Upper Limit = $\bar{x}_{AOm} - \bar{x}_{AOf} + (t)(s_{\bar{x}_{AOm} - \bar{x}_{AOf}})$

Lower Limit = `r male.sample.mean` - `r female.sample.mean` + (`r t.99`)(`r mf.sampling.diff.estse`)

Upper Limit = `r mf.UL`

99% Confidence Level:

`r mf.LL` $\leq \mu_{Aom} - \mu_{AOf} \geq$ `r mf.UL`

### Solution

Based on a 99% confidence interval on the difference between gender means, we cannot infer a significant difference between the amount that males and females use agressive behavior to improve an angry mood.

99% Confidence Interval on the difference between gender means:

`r mf.LL` $\leq \mu_{Aom} - \mu_{AOf} \geq$ `r mf.UL`

## Chapter 10, Q25.

### 1. Calculate sample difference between means:

```{r q25-mean}
ath.sample.size <- sum(am.df$Sports == 1)
nonath.sample.size <- sum(am.df$Sports == 2)

ath.sample.mean <- mean(am.df$Anger.In[am.df$Sports == 1])
nonath.sample.mean <- mean(am.df$Anger.In[am.df$Sports == 2])
an.sample.mean.diff <-  ath.sample.mean - nonath.sample.mean
```

$\bar{x}_{AIa}$ = `r ath.sample.mean`

$\bar{x}_{AIn}$ = `r nonath.sample.mean`

$\bar{x}_{AIa} - \bar{x}_{AIn}$ = `r an.sample.mean.diff`

Visualize distributions:

```{r q25-boxplot}
list.q25 <- list(
  Athletes = am.df$Anger.In[am.df$Sports == 1], 
  "Non-Athletes" = am.df$Anger.In[am.df$Sports != 1])

boxplot(list.q25, main = "Anger In Scores, Type 7")
```

### 2. Estimate the standard error of the difference between means:

```{r q25-estse}
ath.SS <- sum((am.df$Anger.In[am.df$Sports == 1] - ath.sample.mean)^2)
nonath.SS <- sum((am.df$Anger.In[am.df$Sports == 2] - nonath.sample.mean)^2)
an.SSE <- ath.SS + nonath.SS

an.df <- (ath.sample.size - 1) + (nonath.sample.size - 1)
an.MSE <- an.SSE / an.df
an.hmean <- 2 / (1/ath.sample.size + 1/nonath.sample.size)

an.sampling.diff.estse <- sqrt(2* an.MSE / an.hmean)
```

$s_{\bar{x}_{AIa} - \bar{x}_{AIn}} = \sqrt{\frac{2MSE}{n_h}}$

$MSE = \frac{SSE}{df}$

$SSE = \sum_{i}^{n} (x_{Aom_{i}} - \bar{x}_{AIa})^2 + \sum_{i}^{n} (x_{AOf_i} - \bar{x}_{AIn})^2$

$SSE = \sum_{i}^{`r ath.sample.size`}(x_{AIa_{i}} - `r ath.sample.mean`)^2 +
  \sum_{i}^{`r nonath.sample.size`}(x_{AIn_i} - `r nonath.sample.mean`)^2$
  
$SSE = `r an.SSE`$

$df = (n_{AIa} - 1) + (n_{AIn} - 1) = (`r ath.sample.size` - 1) + (`r nonath.sample.size` - 1) = `r an.df`$

$MSE = \frac{SSE}{df} = \frac{`r an.SSE`}{`r an.df`} = `r an.MSE`$

$n_h = \frac{2}{(\frac{1}{n_{AIa}} + \frac{1}{n_{AIn}})} = \frac{2}{(\frac{1}{`r ath.sample.size`} +
  \frac{1}{`r nonath.sample.size`})} = `r an.hmean`$

$s_{\bar{x}_{AIa} - \bar{x}_{AIn}} = \sqrt{\frac{2MSE}{n_h}}$

$s_{\bar{x}_{AIa} - \bar{x}_{AIn}} = \sqrt{\frac{(2)(`r an.MSE`)}{`r an.hmean`}} = `r an.sampling.diff.estse`$

### 3. Find t critical value:

```{r q25-ci}
Y.95 <- 0.95
t.95 <- qt((1 - Y.95)/2, df = an.df, lower.tail = FALSE)

an.LL <- ath.sample.mean - nonath.sample.mean - (t.95 * an.sampling.diff.estse)
an.UL <- ath.sample.mean - nonath.sample.mean + (t.95 * an.sampling.diff.estse)

```

Degrees of Freedom = `r an.df`

95% t Critical Value= `r t.95`

### 4. Calculate confidence interval:

Lower Limit = $\bar{x}_{AIa} - \bar{x}_{AIn} - (t)(s_{\bar{x}_{AIa} - \bar{x}_{AIn}})$

Lower Limit = `r ath.sample.mean` - `r nonath.sample.mean` - (`r t.95`)(`r an.sampling.diff.estse`)

Lower Limit = `r an.LL`

Upper Limit = $\bar{x}_{AIa} - \bar{x}_{AIn} + (t)(s_{\bar{x}_{AIa} - \bar{x}_{AIn}})$

Lower Limit = `r ath.sample.mean` - `r nonath.sample.mean` + (`r t.95`)(`r an.sampling.diff.estse`)

Upper Limit = `r an.UL`

95% Confidence Level:

`r an.LL` $\leq \mu_{AIa} - \mu_{AIn} \geq$ `r an.UL`

### Solution

Based on a 95% confidence interval on the difference between athlete and non-athlete means, we can infer a significant difference between the extent to which athletes and non-athletes supress their anger, as the data demonstrates that non-athletes supress their anger more than athletes.

95% Confidence Interval on the difference between athletes and non-athletes:

`r an.LL` $\leq \mu_{AIa} - \mu_{AIn} \geq$ `r an.UL`

## Chapter 10, Q26.

### 1. Calculate sample correlation:

```{r q26-corr}
x <- am.df$Anger.Out
y <- am.df$Control.Out
x.bar <- mean(x)
y.bar <- mean(y)

# Calculate Pearson's correlation manually
aoco.r.manual <- sum((x - x.bar) * (y - y.bar)) / ((sqrt(sum((x - x.bar)^2))) * (sqrt(sum((y - y.bar)^2))))

# Calculate Pearson's correlation with built-in R function
aoco.r <- cor(x, y, method = "pearson")
```

Manual calculation of correlation between Control-In and Control-Out: 

r = `r aoco.r.manual`

Calculation of correlation between Control-In and Control-Out using cor(): 

r = `r aoco.r`

#### Visualize correlation

```{r q26-plot}
plot(am.df$Anger.Out, am.df$Control.Out)
```

### 2. Convert r to z':

```{r q26-to-zprime}
# Look up on http://onlinestatbook.com/calculators/fisher_z.html
aoco.zprime <- -0.667
```

z' = `r aoco.zprime`

### 3. Compute a confidence interval in terms of z':

```{r q26-ci}
am.sample.size <- nrow(am.df)

aoco.zprime.sampling.se <- 1 / sqrt(am.sample.size - 3)

Z.95 <- qnorm((1 - Y.95)/2, lower.tail = FALSE)

aoco.zprime.LL <- aoco.zprime - Z.95 * aoco.zprime.sampling.se
aoco.zprime.UL <- aoco.zprime + Z.95 * aoco.zprime.sampling.se
```

95% Z Critical Value= `r Z.95`

$s_{z'} = \frac{1}{\sqrt{n - 3}} = \frac{1}{\sqrt{`r am.sample.size` - 3}} = `r aoco.zprime.sampling.se`$

Lower Limit = $z' - (Z)(s_{z'})$

Lower Limit = `r aoco.zprime` - (`r Z.95`)(`r aoco.zprime.sampling.se`)

Lower Limit = `r aoco.zprime.LL`

Upper Limit = $z' + (Z)(s_{z'})$

Lower Limit = `r aoco.zprime` + (`r Z.95`)(`r aoco.zprime.sampling.se`)

Upper Limit = `r aoco.zprime.UL`

95% Confidence Level:

`r aoco.zprime.LL` $\leq z' \geq$ `r aoco.zprime.UL`

### 4. Convert the confidence interval back to r:

```{r q26-from-zprime}
# Look up on http://onlinestatbook.com/calculators/fisher_z.html
aoco.p.UL <- -0.713
aoco.p.LL <- -0.414
```

Lower Limit = `r aoco.p.LL`

Upper Limit = `r aoco.p.UL`

### Solution

95% Confidence Level:

`r aoco.p.LL` $\leq \rho \geq$ `r aoco.p.UL`

## Chapter 11, Q20

False

## Chapter 11, Q21
!!!XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

## Chapter 11, Q22

True

## Chapter 11, Q23

True

## Chapter 11, Q24

True